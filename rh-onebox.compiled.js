!function(e,t){if("function"==typeof define&&define.amd)define(["exports","../rhelement/rhelement.compiled.js","../../whatwg-fetch/fetch.js"],t);else if("undefined"!=typeof exports)t(exports,require("../rhelement/rhelement.compiled.js"),require("../../whatwg-fetch/fetch.js"));else{var n={};t(n,e.rhelementCompiled,e.fetch),e.rhOnebox=n}}(this,function(e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(e){return e&&e.__esModule?e:{default:e}}(t),r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.template||console.warn("A template needs to be provided in the constructor"),r.elementName=e,r.config=n,r.htmlTemplate=n.template,r.loading=!1,r._sources={},r.getData=r.getData.bind(r),r.findMatch=r.findMatch.bind(r),r.successHandler=r.successHandler.bind(r),r.errorHandler=r.errorHandler.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.default),r(t,[{key:"source",get:function(){return this._source},set:function(e){this._source!==e&&(this._source=e,this.setAttribute("source",this._source),this.getData())}},{key:"term",get:function(){return this._term},set:function(e){this._term!==e&&(this._term=e,this.setAttribute("term",this._term),this.getData())}},{key:"match",get:function(){return this._match},set:function(e){this._match!==e&&(this._match=e)}},{key:"data",get:function(){return this._data},set:function(e){this._data=e,this._sources[this.source]=this._data,this.findMatch(this._data)}}]),r(t,[{key:"attributeChangedCallback",value:function(e,t,n){this[e]=n}},{key:"getData",value:function(){var e=this;if(this.htmlTemplate&&this.source&&!this.loading)return this._sources[this.source]?(this.data=this._sources[this.source],void this.successHandler()):(this.loading=!0,fetch(this.source).then(function(e){return e.json()},function(t){return e.errorHandler}).then(function(t){e.data=t}).then(this.successHandler).then(function(){return e.loading=!1}))}},{key:"successHandler",value:function(){this.render()}},{key:"errorHandler",value:function(e){console.log(e)}},{key:"findMatch",value:function(e){var t=this;e[this.config.arrayName].forEach(function(e){e[t.config.matchArrayName].forEach(function(n){n.toLowerCase()!==t.term.toLowerCase().trim()||(t.match=e)})})}},{key:"render",value:function(e){var t=this.match?this.htmlTemplate(Object.assign({},this.match,e)):"";for(window.ShadyCSS&&ShadyCSS.prepareTemplate(t,this.elementName);this.shadowRoot.firstChild;)this.shadowRoot.removeChild(this.shadowRoot.firstChild);this.shadowRoot.appendChild(t.content.cloneNode(!0)),window.ShadyCSS&&ShadyCSS.styleElement(this)}}],[{key:"observedAttributes",get:function(){return["source","term"]}}]),t}();e.default=i});